<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <title>Hello World</title>
    <script src="react.js"></script>
    <script src="react-dom.js"></script>
    <script src="babel.min.js"></script>
    <style>
    .field{
      margin-bottom: 10px;
    }
    label{
      display: block;
    }
    #divResult{
      color : red;
      font-size: 22pt;
      font-weight: bold;
    }
    body{
      margin-left : 50px;
    }
  </style>
  </head>
  <body>

    <div id="root"></div>

    <script type="text/babel">
      function Greeter(){
          var _data = {
            firstName : '',
            lastName : '',
            message : ''
          };

          this.get = function(attrName){
            return _data[attrName];
          };

          this.set = function(attrName, value){
            if (_data[attrName] === value) return;
            _data[attrName] = value;

            //trigger change notification for 'attrName'
            triggerChange(attrName);
            triggerChange('all');
            
          };

          function triggerChange(attrName){
            var listenerFns = _changeListeners[attrName] || [];
            listenerFns.forEach(function(listenerFn){
              if (typeof listenerFn === 'function')
                listenerFn(); 
            });
          }

          var _changeListeners = {
            firstname : [],
            lastName : [],
            message : [],
            all : []
          };

          this.onChange = function(attrName, listenerFn){
            _changeListeners[attrName].push(listenerFn);
          };

          this.toJson = function(){
            return {
              firstName : _data.firstName,
              lastName : _data.lastName,
              message : _data.message
            };
          };
      }
      Greeter.prototype.greet = function(){
        var message = 'Hi ' + this.get('firstName') + ' ' + this.get('lastName') + ', Have a nice day!';
        this.set('message', message);
        console.log(this.toJson());
      }

      var GreeterComponent = React.createClass({
        updateFirstName : function(){
          this.props.data.set('firstName', this.refs.txtFirstName.value);
        },
        updateLastName : function(){
          this.props.data.set('lastName', this.refs.txtLastName.value);
        },
        greetClick : function(){
          this.props.data.greet();
        },
        render : function(){
          var greeterData = this.props.data.toJson();
          return (

            <div>
              <h1>Greeter</h1>
              <div className="field">
                <label htmlFor="">First Name :</label>
                <input type="text" ref="txtFirstName" defaultValue={greeterData.firstName} onChange={this.updateFirstName} />
              </div>
              <div className="field">
                <label htmlFor="">Last Name :</label>
                <input type="text" ref="txtLastName" defaultValue={greeterData.lastName} onChange={this.updateLastName} />
              </div>
              <div className="field">
                <input type="button" value="Greet" id="btnGreet" onClick={this.greetClick} />
              </div>
              <div className="field">
                <div>{greeterData.message}</div>
              </div>
            </div>
          )
        }
      })
      String.prototype.toInt = function(){
        return parseInt(this,10);
      };


      var SalaryCalculatorComponent = React.createClass({
        getInitialState : function(){
          return {
            basic : 0,
            hra : 0,
            da : 0,
            tax : 0,
            salary : 0
          }
        },
        calculateClick : function(){
          var data = this.state;
          var gross = data.basic + data.hra + data.da;
          var net = gross * ((100-data.tax)/100);
          this.setState({salary : net});
        },
        updateBasic : function(){
          this.setState({basic : this.refs.txtBasic.value.toInt()})
        },
        updateHra : function(){
          this.setState({hra : this.refs.txtHra.value.toInt()})
        },
        updateDa : function(){
          this.setState({da : this.refs.txtDa.value.toInt()})
        },
        updateTax : function(){
          this.setState({tax : this.refs.rangeTax.value.toInt()})
        },
        render : function(){
          return (
            <div className="content">
              <div className="field">
                <label htmlFor="">Basic :</label>
                <input type="text" ref="txtBasic" onChange={this.updateBasic}/>
              </div>
              <div className="field">
                <label htmlFor="">HRA :</label>
                <input type="text" ref="txtHra" onChange={this.updateHra}/>
              </div>
              <div className="field">
                <label htmlFor="">DA :</label>
                <input type="text" ref="txtDa" onChange={this.updateDa}/>
              </div>
              <div className="field">
                <label htmlFor="">Tax :</label>
                <input type="range" ref="rangeTax" min="0" max="30" defaultValue={this.state.tax} onChange={this.updateTax} />
                <span id="spanTax">{this.state.tax}</span>
              </div>
              <div className="field">
                <input type="button" value="Calculate" onClick={this.calculateClick} />
              </div>
              <div className="field">
                <div id="divResult">{this.state.salary}</div>
              </div>
          </div>
          )
        }
      })
      
      var greeter = new Greeter();
      greeter.set('firstName', 'Magesh');
      greeter.set('lastName', 'Kuppan');
      greeter.set('message', 'Default greet message!');
      
      greeter.onChange('all', renderGreeter);

      function renderGreeter(){
        ReactDOM.render(
          <GreeterComponent data={greeter}></GreeterComponent>
          ,document.getElementById('root')
        );
      }
      renderGreeter();

    </script>
  </body>
</html>
